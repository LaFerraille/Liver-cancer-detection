Here we consider $J$ data matrices $X_1,...X_J$ with $J=7$ where each $n \times p_j$ matrix $X_j$ is a block and represents a set of $p_j$ variables observed on $n$ individuals. The objective of RGCCA is to find, for each block $X_j$ a weighted composite of variables $y_j = X_ja_j$ summarizing the relevant information between and within the blocks. The block components are obtained such that (i) block components explain well their own block and/or (ii) block components that are assumed to be connected are highly correlated.

```{r}
install.packages('RGCCA')
# Chargement des packages
library(RGCCA)
```

```{r}
# Set the repo to the current directory
setwd("/Users/raphaelromandferroni/Desktop/AMDA/Liver-cancer-detection")
```

```{r}
# Chargement de data/processed/global_radio_rgcca.csv
data <- read.csv("data/processed/global_radio_rgcca.csv", header = TRUE, sep = ",")
View(data)
```

We define the 7 blocks
```{r}
# X1 = data[,1:18] # First Order Features
# X2 = data[,19:32] # Shape
# X3 = data[,33:56] # Grey Level Co-occurence Matrix
# X4 = data[,57:70] # Grey Level Dependence Matrix
# X5 = data[,71:86] # Grey Level Run Length Matrix
# X6 = data[,87:102] # Grey Level Size Zone Matrix
# X7 = data[,103:107] # Neighbourhood Grey Tone Difference Matrix
X1 = data[,1:18] # First Order Features
X2 = data[,19:32] # Shape
X3 = data[,33:107] # Texture
X4 = data[,108:109] # Labels
```

We apply RGCCA to the 7 blocks
```{r}
# L = list(firstorder = X1, shape = X2, glcm = X3, gldm = X4, glrlm = X5, glszm = X6, ngtdm = X7)
# C <- matrix(
#   c(0, 0, 1, 1, 0, 0, 0,
#     0, 0, 0, 0, 0, 1, 0,
#     1, 0, 0, 1, 1, 0, 1,
#     1, 0, 1, 0, 0, 0, 1,
#     0, 0, 1, 0, 0, 0, 0,
#     0, 1, 0, 0, 0, 0, 0,
#     0, 0, 1, 1, 0, 0, 0),
#   nrow = 7,
#   ncol = 7,
# )
L = list(firstorder = X1, shape = X2, texture = X3, labels = X4)
C <- matrix(
  c(0, 0, 0, 1,
    0, 0, 0, 1,
    0, 0, 0, 1,
    1, 1, 1, 0),
  nrow = 4,
  ncol = 4,
)
```


```{r}
tau = c(1, 1, 1, 0)
```

```{r}
fit.rgcca = rgcca(L, connection = C, tau = tau, 
                  scheme = function(x) x^2, ncomp = c(2, 2, 2, 2),
                  init = "random", verbose = TRUE, tol = 1e-16)
```

```{r}
plot(fit.rgcca, display_order = FALSE, comp = 2)
```

```{r}
boot_out = rgcca_bootstrap(fit.rgcca, 500)
print(boot_out)
```

```{r}
plot(boot_out, display_order = FALSE)
```

```{r, fig.cap = 'Factor plot - y1 vs y2'}

lab = factor(apply(data[, 108:110], 1, which.max),
labels = c("CCK", "CHC", "Mixtes"))
lab
plot(fit.rgcca, type = "sample", resp = lab)
```

```{r}
plot(fit.rgcca, type = "cor_circle", comp = 1:2)
```